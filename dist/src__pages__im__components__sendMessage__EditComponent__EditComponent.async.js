"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[521,128],{24552:function(Q,x,e){e.r(x),e.d(x,{default:function(){return q}});var O=e(54306),y=e.n(O),P=e(12342),U=e.n(P),B=e(57213),f=e.n(B),m=e(93236),p=e(17607),T=e(66466),c=e(22018),L=e(22978),C=e(48721),R=e(61793),K=e(85108),I=e(6420),W=e(79766),H=e(93900),F=e(80382),N=e(66680),Z=e(88825),h={editor:"editor___AcobX",emojiBox:"emojiBox___OCwv_",count:"count___gjETG",counterOverLimit:"counterOverLimit___m7ZyI"},M={mention:"mention___e08UF",mentionSuggestions:"mentionSuggestions___xV0Oy",mentionSuggestionsEntryContainer:"mentionSuggestionsEntryContainer___RS_bu",mentionSuggestionsEntryContainerLeft:"mentionSuggestionsEntryContainerLeft___Obkfm",mentionSuggestionsEntryContainerRight:"mentionSuggestionsEntryContainerRight___aAbxo",mentionSuggestionsEntry:"mentionSuggestionsEntry___c0x64",mentionSuggestionsEntryFocused:"mentionSuggestionsEntryFocused___jKUAV",mentionSuggestionsEntryText:"mentionSuggestionsEntryText___uC5ih",mentionSuggestionsEntryTitle:"mentionSuggestionsEntryTitle___feT0M",mentionSuggestionsEntryAvatar:"mentionSuggestionsEntryAvatar___ar8FJ"},V=e(52007),S=e(87848),r=e(12881),n=e(62086),t=["mention","theme","searchValue","isFocused"],o=(0,R.Z)({useNativeArt:!0}),i=(0,K.Z)(),u=o.EmojiSuggestions,g=o.EmojiSelect,E=(0,I.Z)({component:function(b){var s=b.href,j=(0,p.Z)(b,["className"]);return(0,n.jsx)("a",f()(f()({},j),{},{style:{color:"#5e93c5",textDecoration:"none"},onClick:function(){return window.open(s,"_blank")}}))}}),v=(0,W.Z)({theme:{counter:h.counter,counterOverLimit:h.counterOverLimit}}),Y=v.CharCounter,yn=c.KeyBindingUtil.hasCommandModifier;function k(a){return a.code==="KeyZ"?"undo":a.keyCode===13&&!a.shiftKey?"send-msg":(0,c.getDefaultKeyBinding)(a)}function w(a){var b=a.mention,s=a.theme,j=a.searchValue,D=a.isFocused,G=U()(a,t);return(0,n.jsx)("div",f()(f()({},G),{},{children:(0,n.jsx)("div",{className:s==null?void 0:s.mentionSuggestionsEntryContainer,children:(0,n.jsxs)("div",{className:s==null?void 0:s.mentionSuggestionsEntryContainerRight,children:[(0,n.jsx)("div",{className:s==null?void 0:s.mentionSuggestionsEntryText,children:b.name}),(0,n.jsx)("div",{className:s==null?void 0:s.mentionSuggestionsEntryTitle,children:b.title})]})})}))}function q(){var a=(0,m.useRef)(null),b=(0,m.useState)(function(){return c.EditorState.createEmpty()}),s=y()(b,2),j=s[0],D=s[1],G=(0,m.useState)(!1),X=y()(G,2),nn=X[0],en=X[1],tn=(0,T.tT)("im.member"),z=tn.members,on=(0,T.tT)("im.message"),rn=on.setMessages,sn=(0,m.useState)(z),J=y()(sn,2),an=J[0],un=J[1],$=(0,m.useMemo)(function(){var l=(0,C.ZP)({entityMutability:"IMMUTABLE",theme:M,mentionPrefix:"@",supportWhitespace:!0}),_=l.MentionSuggestions,d=[l,o,i,E,v];return{plugins:d,MentionSuggestions:_}},[]),ln=$.MentionSuggestions,_n=$.plugins,dn=(0,m.useCallback)(function(l){D(l)},[]),mn=(0,m.useCallback)(function(l){en(l)},[]),cn=(0,m.useCallback)(function(l){var _=l.value;un((0,C.zk)(_,z))},[]),gn=function(){var _,d;if((_=a.current.editor.editor)!==null&&_!==void 0&&_.firstChild){var A=(0,V.createElementMap)((d=a.current.editor.editor)===null||d===void 0?void 0:d.firstChild);rn({type:S.MessageType.RICHTEXT,uuid:(0,r.Z)(),sendId:"2",send:"\u674E\u56DB",message:[A],createTime:+new Date,sendType:S.SendType.OUT})}},vn=function(_){var d=j.getCurrentContent(),A=d.createEntity("IMAGE","IMMUTABLE",{src:_}),En=A.getLastCreatedEntityKey(),bn=c.EditorState.set(j,{currentContent:A});return c.AtomicBlockUtils.insertAtomicBlock(bn,En," ")},fn=function(_){var d=URL.createObjectURL(new Blob(_));D(vn(d))},hn=function(_){return _==="send-msg"?(gn(),"handled"):"not-handled"};return(0,n.jsxs)("div",{className:h.editor,onClick:function(){a.current.focus()},children:[(0,n.jsx)("div",{className:h.emojiBox,children:(0,n.jsx)(g,{})}),(0,n.jsx)(L.ZP,{editorKey:"editor",editorState:j,onChange:dn,plugins:_n,ref:a,keyBindingFn:k,handleKeyCommand:hn,handlePastedFiles:fn}),(0,n.jsxs)("span",{className:h.count,children:[(0,n.jsx)(Y,{limit:2e4}),"/20000"]}),(0,n.jsx)(u,{}),(0,n.jsx)(ln,{open:nn,onOpenChange:mn,suggestions:an,onSearchChange:cn,onAddMention:function(){},entryComponent:w,popoverContainer:function(_){var d=_.children;return(0,n.jsx)("div",{style:{minWidth:"100px",position:"absolute"},children:d})}})]})}},52007:function(Q,x,e){e.r(x),e.d(x,{camelToDash:function(){return Z},createElement:function(){return W},createElementMap:function(){return H},fileToBlob:function(){return M},fileToBlobUrl:function(){return V},getAllAttributes:function(){return F},getFileName:function(){return I},getSuffix:function(){return K},nodeToString:function(){return h},objToString:function(){return N}});var O=e(25359),y=e.n(O),P=e(49811),U=e.n(P),B=e(37635),f=e.n(B),m=e(93525),p=e.n(m),T=e(57213),c=e.n(T),L=e(54306),C=e.n(L),R=e(17607),K=function(n){var t;return((t=/[^.]*$/g.exec(n))===null||t===void 0?void 0:t[0])||""},I=function(n){var t;return((t=/[^/]*$/g.exec(n))===null||t===void 0?void 0:t[0])||""},W=function r(n){if(typeof n=="string")return document.createTextNode(n);var t=document.createElement(n.type),o=(0,R.Z)(n,["type","children"]);if(Object.entries(o).forEach(function(u){var g=C()(u,2),E=g[0],v=g[1];t.setAttribute(E,N(v))}),n.children){var i=n.children.map(function(u){return r(u)});i.forEach(function(u){return t.appendChild(u)})}return t},H=function r(n){if(!(n instanceof HTMLElement))return{type:"span"};var t=n.tagName.toLocaleLowerCase(),o=F(n),i=n.children;return c()(c()({type:t},o),{},{children:i.length?p()(i).map(function(u){return r(u)}):[n.innerText]})},F=function(n){var t=p()(n.attributes).map(function(o){return o.name});return Object.fromEntries(t.map(function(o){return[o,n.getAttribute(o)]}))},N=function(n){return f()(n)!=="object"?n:Object.entries(n).map(function(t){var o=C()(t,2),i=o[0],u=o[1];return"".concat(Z(i),":").concat(u,";")}).join("")};function Z(r){return r.replace(/[A-Z]/g,function(n){return"-"+n.toLowerCase()})}var h=function(n){if(typeof n=="string")return n;var t=document.createElement("div");return t.appendChild(n),t.innerHTML};function M(r){var n=new FileReader;return new Promise(function(t){n.addEventListener("load",function(o){var i,u,g;if(f()((i=o.target)===null||i===void 0?void 0:i.result)==="object"&&(u=o.target)!==null&&u!==void 0&&u.result){var E;g=new Blob([(E=o.target)===null||E===void 0?void 0:E.result])}else{var v;g=(v=o.target)===null||v===void 0?void 0:v.result}t(g)}),n.readAsArrayBuffer(r)})}function V(r){return S.apply(this,arguments)}function S(){return S=U()(y()().mark(function r(n){var t;return y()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,M(n);case 2:return t=i.sent,i.abrupt("return",URL.createObjectURL(t));case 4:case"end":return i.stop()}},r)})),S.apply(this,arguments)}}}]);
