"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[681,521,128],{24552:function(X,f,n){n.r(f),n.d(f,{default:function(){return un}});var P=n(25359),y=n.n(P),p=n(49811),x=n.n(p),T=n(54306),C=n.n(T),N=n(12342),A=n.n(N),Z=n(57213),b=n.n(Z),c=n(93236),U=n(17607),B=n(66466),h=n(22018),G=n(22978),L=n(48721),V=n(61793),R=n(85108),K=n(6420),I=n(79766),z=n(93900),$=n(80382),J=n(66680),W=n(88825),o={editor:"editor___AcobX",emojiBox:"emojiBox___OCwv_",count:"count___gjETG",counterOverLimit:"counterOverLimit___m7ZyI"},e={mention:"mention___e08UF",mentionSuggestions:"mentionSuggestions___xV0Oy",mentionSuggestionsEntryContainer:"mentionSuggestionsEntryContainer___RS_bu",mentionSuggestionsEntryContainerLeft:"mentionSuggestionsEntryContainerLeft___Obkfm",mentionSuggestionsEntryContainerRight:"mentionSuggestionsEntryContainerRight___aAbxo",mentionSuggestionsEntry:"mentionSuggestionsEntry___c0x64",mentionSuggestionsEntryFocused:"mentionSuggestionsEntryFocused___jKUAV",mentionSuggestionsEntryText:"mentionSuggestionsEntryText___uC5ih",mentionSuggestionsEntryTitle:"mentionSuggestionsEntryTitle___feT0M",mentionSuggestionsEntryAvatar:"mentionSuggestionsEntryAvatar___ar8FJ"},r=n(52007),i=n(87848),a=n(12881),t=n(62086),E=["mention","theme","searchValue","isFocused"],v=(0,V.Z)({useNativeArt:!0}),S=(0,R.Z)(),en=v.EmojiSuggestions,tn=v.EmojiSelect,rn=(0,K.Z)({component:function(m){var u=m.href,M=(0,U.Z)(m,["className"]);return(0,t.jsx)("a",b()(b()({},M),{},{style:{color:"#5e93c5",textDecoration:"none"},onClick:function(){return window.open(u,"_blank")}}))}}),Q=(0,I.Z)({theme:{counter:o.counter,counterOverLimit:o.counterOverLimit}}),on=Q.CharCounter,Dn=h.KeyBindingUtil.hasCommandModifier;function an(_){return _.code==="KeyZ"?"undo":_.keyCode===13&&!_.shiftKey?"send-msg":(0,h.getDefaultKeyBinding)(_)}function sn(_){var m=_.mention,u=_.theme,M=_.searchValue,D=_.isFocused,O=A()(_,E);return(0,t.jsx)("div",b()(b()({},O),{},{children:(0,t.jsx)("div",{className:u==null?void 0:u.mentionSuggestionsEntryContainer,children:(0,t.jsxs)("div",{className:u==null?void 0:u.mentionSuggestionsEntryContainerRight,children:[(0,t.jsx)("div",{className:u==null?void 0:u.mentionSuggestionsEntryText,children:m.name}),(0,t.jsx)("div",{className:u==null?void 0:u.mentionSuggestionsEntryTitle,children:m.title})]})})}))}function un(_){var m=(0,c.useRef)(null),u=(0,c.useState)(function(){return h.EditorState.createEmpty()}),M=C()(u,2),D=M[0],O=M[1],ln=(0,c.useState)(!1),Y=C()(ln,2),dn=Y[0],_n=Y[1],mn=(0,B.tT)("im.member"),k=mn.members,cn=(0,B.tT)("im.message"),gn=cn.setMessages,vn=(0,c.useState)(k),w=C()(vn,2),fn=w[0],hn=w[1],q=(0,c.useMemo)(function(){var s=(0,L.ZP)({entityMutability:"IMMUTABLE",theme:e,mentionPrefix:"@",supportWhitespace:!0}),l=s.MentionSuggestions,d=[s,v,S,rn,Q];return{plugins:d,MentionSuggestions:l}},[]),En=q.MentionSuggestions,yn=q.plugins,bn=(0,c.useCallback)(function(s){O(s)},[]),Sn=(0,c.useCallback)(function(s){_n(s)},[]),Cn=(0,c.useCallback)(function(s){var l=s.value;hn((0,L.zk)(l,k))},[]),jn=function(){var l=h.EditorState.createEmpty();O(l),setTimeout(function(){var d,g;(d=m.current)===null||d===void 0||d.blur(),(g=m.current)===null||g===void 0||g.focus()})},pn=function(){var s=x()(y()().mark(function l(){var d,g,F;return y()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if((d=m.current.editor.editor)!==null&&d!==void 0&&d.firstChild){j.next=2;break}return j.abrupt("return");case 2:return F=(0,r.createElementMap)((g=m.current.editor.editor)===null||g===void 0?void 0:g.firstChild),j.next=5,gn({type:i.MessageType.RICHTEXT,uuid:(0,a.Z)(),sendId:"2",send:"\u674E\u56DB",message:[F],createTime:+new Date,sendType:i.SendType.OUT});case 5:jn(),setTimeout(function(){var H;(H=_.messageRef)===null||H===void 0||H.scrollTo({top:9999999999999,behavior:"smooth"})});case 7:case"end":return j.stop()}},l)}));return function(){return s.apply(this,arguments)}}(),xn=function(l){var d=D.getCurrentContent(),g=d.createEntity("IMAGE","IMMUTABLE",{src:l}),F=g.getLastCreatedEntityKey(),nn=h.EditorState.set(D,{currentContent:g});return h.AtomicBlockUtils.insertAtomicBlock(nn,F," ")},Tn=function(l){var d=URL.createObjectURL(new Blob(l));O(xn(d))},Mn=function(l){return l==="send-msg"?(pn(),"handled"):"not-handled"};return(0,t.jsxs)("div",{className:o.editor,onClick:function(){m.current.focus()},children:[(0,t.jsx)("div",{className:o.emojiBox,children:(0,t.jsx)(tn,{})}),(0,t.jsx)(G.ZP,{editorKey:"editor",editorState:D,onChange:bn,plugins:yn,ref:m,keyBindingFn:an,handleKeyCommand:Mn,handlePastedFiles:Tn}),(0,t.jsxs)("span",{className:o.count,children:[(0,t.jsx)(on,{limit:2e4}),"/20000"]}),(0,t.jsx)(en,{}),(0,t.jsx)(En,{open:dn,onOpenChange:Sn,suggestions:fn,onSearchChange:Cn,onAddMention:function(){},entryComponent:sn,popoverContainer:function(l){var d=l.children;return(0,t.jsx)("div",{style:{minWidth:"100px",position:"absolute"},children:d})}})]})}},21716:function(X,f,n){n.r(f),n.d(f,{default:function(){return x}});var P=n(93236),y=n(24552),p=n(62086);function x(T){return(0,p.jsx)(y.default,{messageRef:T.messageRef})}},52007:function(X,f,n){n.r(f),n.d(f,{camelToDash:function(){return I},createElement:function(){return L},createElementMap:function(){return V},fileToBlob:function(){return $},fileToBlobUrl:function(){return J},getAllAttributes:function(){return R},getFileName:function(){return G},getSuffix:function(){return h},nodeToString:function(){return z},objToString:function(){return K}});var P=n(25359),y=n.n(P),p=n(49811),x=n.n(p),T=n(37635),C=n.n(T),N=n(93525),A=n.n(N),Z=n(57213),b=n.n(Z),c=n(54306),U=n.n(c),B=n(17607),h=function(e){var r;return((r=/[^.]*$/g.exec(e))===null||r===void 0?void 0:r[0])||""},G=function(e){var r;return((r=/[^/]*$/g.exec(e))===null||r===void 0?void 0:r[0])||""},L=function o(e){if(typeof e=="string")return document.createTextNode(e);var r=document.createElement(e.type),i=(0,B.Z)(e,["type","children"]);if(Object.entries(i).forEach(function(t){var E=U()(t,2),v=E[0],S=E[1];r.setAttribute(v,K(S))}),e.children){var a=e.children.map(function(t){return o(t)});a.forEach(function(t){return r.appendChild(t)})}return r},V=function o(e){if(!(e instanceof HTMLElement))return{type:"span"};var r=e.tagName.toLocaleLowerCase(),i=R(e),a=e.children;return b()(b()({type:r},i),{},{children:a.length?A()(a).map(function(t){return o(t)}):[e.innerText]})},R=function(e){var r=A()(e.attributes).map(function(i){return i.name});return Object.fromEntries(r.map(function(i){return[i,e.getAttribute(i)]}))},K=function(e){return C()(e)!=="object"?e:Object.entries(e).map(function(r){var i=U()(r,2),a=i[0],t=i[1];return"".concat(I(a),":").concat(t,";")}).join("")};function I(o){return o.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()})}var z=function(e){if(typeof e=="string")return e;var r=document.createElement("div");return r.appendChild(e),r.innerHTML};function $(o){var e=new FileReader;return new Promise(function(r){e.addEventListener("load",function(i){var a,t,E;if(C()((a=i.target)===null||a===void 0?void 0:a.result)==="object"&&(t=i.target)!==null&&t!==void 0&&t.result){var v;E=new Blob([(v=i.target)===null||v===void 0?void 0:v.result])}else{var S;E=(S=i.target)===null||S===void 0?void 0:S.result}r(E)}),e.readAsArrayBuffer(o)})}function J(o){return W.apply(this,arguments)}function W(){return W=x()(y()().mark(function o(e){var r;return y()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,$(e);case 2:return r=a.sent,a.abrupt("return",URL.createObjectURL(r));case 4:case"end":return a.stop()}},o)})),W.apply(this,arguments)}}}]);
