"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[521,128],{24552:function(Y,j,n){n.r(j),n.d(j,{default:function(){return ee}});var U=n(54306),S=n.n(U),B=n(12342),L=n.n(B),R=n(57213),E=n.n(R),c=n(93236),A=n(17607),O=n(66466),g=n(22018),K=n(22978),x=n(48721),I=n(61793),W=n(85108),F=n(6420),N=n(79766),H=n(93900),Z=n(80382),V=n(66680),G=n(88825),b={editor:"editor___AcobX",emojiBox:"emojiBox___OCwv_",count:"count___gjETG",counterOverLimit:"counterOverLimit___m7ZyI",emoji:"emoji___kcUix"},P={mention:"mention___e08UF",mentionSuggestions:"mentionSuggestions___xV0Oy",mentionSuggestionsEntryContainer:"mentionSuggestionsEntryContainer___RS_bu",mentionSuggestionsEntryContainerLeft:"mentionSuggestionsEntryContainerLeft___Obkfm",mentionSuggestionsEntryContainerRight:"mentionSuggestionsEntryContainerRight___aAbxo",mentionSuggestionsEntry:"mentionSuggestionsEntry___c0x64",mentionSuggestionsEntryFocused:"mentionSuggestionsEntryFocused___jKUAV",mentionSuggestionsEntryText:"mentionSuggestionsEntryText___uC5ih",mentionSuggestionsEntryTitle:"mentionSuggestionsEntryTitle___feT0M",mentionSuggestionsEntryAvatar:"mentionSuggestionsEntryAvatar___ar8FJ"},$=n(52007),p=n(87848),r=n(12881),e=n(62086),t=["mention","theme","searchValue","isFocused"],o=(0,I.Z)({useNativeArt:!0,positionSuggestions:function(){return{top:"10px"}}}),i=(0,W.Z)(),l=o.EmojiSuggestions,v=o.EmojiSelect,y=(0,F.Z)({component:function(m){var u=m.href,C=(0,A.Z)(m,["className"]);return(0,e.jsx)("a",E()(E()({},C),{},{style:{color:"#5e93c5",textDecoration:"none"},onClick:function(){return window.open(u,"_blank")}}))}}),f=(0,N.Z)({theme:{counter:b.counter,counterOverLimit:b.counterOverLimit}}),k=f.CharCounter,Se=g.KeyBindingUtil.hasCommandModifier;function w(d){return d.code==="KeyZ"?"undo":d.keyCode===13&&!d.shiftKey?"send-msg":(0,g.getDefaultKeyBinding)(d)}function q(d){var m=d.mention,u=d.theme,C=d.searchValue,T=d.isFocused,M=L()(d,t);return(0,e.jsx)("div",E()(E()({},M),{},{children:(0,e.jsx)("div",{className:u==null?void 0:u.mentionSuggestionsEntryContainer,children:(0,e.jsxs)("div",{className:u==null?void 0:u.mentionSuggestionsEntryContainerRight,children:[(0,e.jsx)("div",{className:u==null?void 0:u.mentionSuggestionsEntryText,children:m.name}),(0,e.jsx)("div",{className:u==null?void 0:u.mentionSuggestionsEntryTitle,children:m.title})]})})}))}function ee(d){var m=(0,c.useRef)(null),u=(0,c.useState)(function(){return g.EditorState.createEmpty()}),C=S()(u,2),T=C[0],M=C[1],ne=(0,c.useState)(!1),X=S()(ne,2),te=X[0],oe=X[1],ie=(0,O.tT)("im.member"),z=ie.members,re=(0,O.tT)("im.message"),se=re.setMessages,ue=(0,c.useState)(z),J=S()(ue,2),ae=J[0],le=J[1],Q=(0,c.useMemo)(function(){var a=(0,x.ZP)({entityMutability:"IMMUTABLE",theme:P,mentionPrefix:"@",supportWhitespace:!0}),s=a.MentionSuggestions,_=[a,o,i,y,f];return{plugins:_,MentionSuggestions:s}},[]),_e=Q.MentionSuggestions,de=Q.plugins,me=(0,c.useCallback)(function(a){M(a)},[]),ce=(0,c.useCallback)(function(a){oe(a)},[]),ge=(0,c.useCallback)(function(a){var s=a.value;le((0,x.zk)(s,z))},[]),ve=function(){var s=g.EditorState.createEmpty();M(s),setTimeout(function(){var _,h;(_=m.current)===null||_===void 0||_.blur(),(h=m.current)===null||h===void 0||h.focus()})},fe=function(){var s,_;if((s=m.current.editor.editor)!==null&&s!==void 0&&s.firstChild){var h=(0,$.createElementMap)((_=m.current.editor.editor)===null||_===void 0?void 0:_.firstChild);se({type:p.MessageType.RICHTEXT,uuid:(0,r.Z)(),sendId:"2",send:"\u674E\u56DB",message:[h],createTime:+new Date,sendType:p.SendType.OUT}),ve(),setTimeout(function(){var D;(D=d.messageRef)===null||D===void 0||D.scrollTo({top:9999999999999,behavior:"smooth"})})}},he=function(s){var _=T.getCurrentContent(),h=_.createEntity("IMAGE","IMMUTABLE",{src:s}),D=h.getLastCreatedEntityKey(),ye=g.EditorState.set(T,{currentContent:h});return g.AtomicBlockUtils.insertAtomicBlock(ye,D," ")},Ee=function(s){var _=URL.createObjectURL(new Blob(s));M(he(_))},be=function(s){return s==="send-msg"?(fe(),"handled"):"not-handled"};return(0,e.jsxs)("div",{className:b.editor,onClick:function(){m.current.focus()},children:[(0,e.jsx)("div",{className:b.emojiBox,children:(0,e.jsx)(v,{})}),(0,e.jsx)(K.ZP,{editorKey:"editor",editorState:T,onChange:me,plugins:de,ref:m,keyBindingFn:w,handleKeyCommand:be,handlePastedFiles:Ee}),(0,e.jsxs)("span",{className:b.count,children:[(0,e.jsx)(k,{limit:2e4}),"/20000"]}),(0,e.jsx)(l,{}),(0,e.jsx)(_e,{open:te,onOpenChange:ce,suggestions:ae,onSearchChange:ge,onAddMention:function(){},entryComponent:q,popoverContainer:function(s){var _=s.children;return(0,e.jsx)("div",{style:{minWidth:"100px",position:"absolute"},children:_})}})]})}},52007:function(Y,j,n){n.r(j),n.d(j,{camelToDash:function(){return G},createElement:function(){return N},createElementMap:function(){return H},fileToBlob:function(){return P},fileToBlobUrl:function(){return $},getAllAttributes:function(){return Z},getFileName:function(){return F},getSuffix:function(){return W},nodeToString:function(){return b},objToString:function(){return V}});var U=n(25359),S=n.n(U),B=n(49811),L=n.n(B),R=n(37635),E=n.n(R),c=n(93525),A=n.n(c),O=n(57213),g=n.n(O),K=n(54306),x=n.n(K),I=n(17607),W=function(e){var t;return((t=/[^.]*$/g.exec(e))===null||t===void 0?void 0:t[0])||""},F=function(e){var t;return((t=/[^/]*(?=\?)/g.exec(e)||/[^/]*$/g.exec(e))===null||t===void 0?void 0:t[0])||""},N=function r(e){if(typeof e=="string")return document.createTextNode(e);var t=document.createElement(e.type),o=(0,I.Z)(e,["type","children"]);if(Object.entries(o).forEach(function(l){var v=x()(l,2),y=v[0],f=v[1];t.setAttribute(y,V(f))}),e.children){var i=e.children.map(function(l){return r(l)});i.forEach(function(l){return t.appendChild(l)})}return t},H=function r(e){if(!(e instanceof HTMLElement))return{type:"span"};var t=e.tagName.toLocaleLowerCase(),o=Z(e),i=e.children;return g()(g()({type:t},o),{},{children:i.length?A()(i).map(function(l){return r(l)}):[e.innerText]})},Z=function(e){var t=A()(e.attributes).map(function(o){return o.name});return Object.fromEntries(t.map(function(o){return[o,e.getAttribute(o)]}))},V=function(e){return E()(e)!=="object"?e:Object.entries(e).map(function(t){var o=x()(t,2),i=o[0],l=o[1];return"".concat(G(i),":").concat(l,";")}).join("")};function G(r){return r.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()})}var b=function(e){if(typeof e=="string")return e;var t=document.createElement("div");return t.appendChild(e),t.innerHTML};function P(r){var e=new FileReader;return new Promise(function(t){e.addEventListener("load",function(o){var i,l,v;if(E()((i=o.target)===null||i===void 0?void 0:i.result)==="object"&&(l=o.target)!==null&&l!==void 0&&l.result){var y;v=new Blob([(y=o.target)===null||y===void 0?void 0:y.result])}else{var f;v=(f=o.target)===null||f===void 0?void 0:f.result}t(v)}),e.readAsArrayBuffer(r)})}function $(r){return p.apply(this,arguments)}function p(){return p=L()(S()().mark(function r(e){var t;return S()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,P(e);case 2:return t=i.sent,i.abrupt("return",URL.createObjectURL(t));case 4:case"end":return i.stop()}},r)})),p.apply(this,arguments)}}}]);
