"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[521,128],{24552:function(ee,p,e){e.r(p),e.d(p,{default:function(){return se}});var K=e(25359),j=e.n(K),I=e(49811),W=e.n(I),F=e(54306),b=e.n(F),N=e(12342),M=e.n(N),Z=e(57213),E=e.n(Z),c=e(93236),D=e(17607),A=e(66466),f=e(22018),G=e(22978),O=e(48721),V=e(61793),P=e(85108),U=e(6420),B=e(79766),X=e(93900),$=e(80382),z=e(66680),L=e(88825),o={editor:"editor___AcobX",emojiBox:"emojiBox___OCwv_",count:"count___gjETG",counterOverLimit:"counterOverLimit___m7ZyI"},n={mention:"mention___e08UF",mentionSuggestions:"mentionSuggestions___xV0Oy",mentionSuggestionsEntryContainer:"mentionSuggestionsEntryContainer___RS_bu",mentionSuggestionsEntryContainerLeft:"mentionSuggestionsEntryContainerLeft___Obkfm",mentionSuggestionsEntryContainerRight:"mentionSuggestionsEntryContainerRight___aAbxo",mentionSuggestionsEntry:"mentionSuggestionsEntry___c0x64",mentionSuggestionsEntryFocused:"mentionSuggestionsEntryFocused___jKUAV",mentionSuggestionsEntryText:"mentionSuggestionsEntryText___uC5ih",mentionSuggestionsEntryTitle:"mentionSuggestionsEntryTitle___feT0M",mentionSuggestionsEntryAvatar:"mentionSuggestionsEntryAvatar___ar8FJ"},r=e(52007),i=e(87848),a=e(12881),t=e(62086),h=["mention","theme","searchValue","isFocused"],v=(0,V.Z)({useNativeArt:!0}),y=(0,P.Z)(),ne=v.EmojiSuggestions,te=v.EmojiSelect,re=(0,U.Z)({component:function(m){var u=m.href,C=(0,D.Z)(m,["className"]);return(0,t.jsx)("a",E()(E()({},C),{},{style:{color:"#5e93c5",textDecoration:"none"},onClick:function(){return window.open(u,"_blank")}}))}}),J=(0,B.Z)({theme:{counter:o.counter,counterOverLimit:o.counterOverLimit}}),oe=J.CharCounter,Me=f.KeyBindingUtil.hasCommandModifier;function ie(_){return _.code==="KeyZ"?"undo":_.keyCode===13&&!_.shiftKey?"send-msg":(0,f.getDefaultKeyBinding)(_)}function ae(_){var m=_.mention,u=_.theme,C=_.searchValue,x=_.isFocused,T=M()(_,h);return(0,t.jsx)("div",E()(E()({},T),{},{children:(0,t.jsx)("div",{className:u==null?void 0:u.mentionSuggestionsEntryContainer,children:(0,t.jsxs)("div",{className:u==null?void 0:u.mentionSuggestionsEntryContainerRight,children:[(0,t.jsx)("div",{className:u==null?void 0:u.mentionSuggestionsEntryText,children:m.name}),(0,t.jsx)("div",{className:u==null?void 0:u.mentionSuggestionsEntryTitle,children:m.title})]})})}))}function se(_){var m=(0,c.useRef)(null),u=(0,c.useState)(function(){return f.EditorState.createEmpty()}),C=b()(u,2),x=C[0],T=C[1],ue=(0,c.useState)(!1),Q=b()(ue,2),le=Q[0],de=Q[1],_e=(0,A.tT)("im.member"),Y=_e.members,me=(0,A.tT)("im.message"),ce=me.setMessages,ge=(0,c.useState)(Y),k=b()(ge,2),ve=k[0],fe=k[1],w=(0,c.useMemo)(function(){var s=(0,O.ZP)({entityMutability:"IMMUTABLE",theme:n,mentionPrefix:"@",supportWhitespace:!0}),l=s.MentionSuggestions,d=[s,v,y,re,J];return{plugins:d,MentionSuggestions:l}},[]),he=w.MentionSuggestions,Ee=w.plugins,ye=(0,c.useCallback)(function(s){T(s)},[]),be=(0,c.useCallback)(function(s){de(s)},[]),Se=(0,c.useCallback)(function(s){var l=s.value;fe((0,O.zk)(l,Y))},[]),pe=function(){var l=f.EditorState.createEmpty();T(l),setTimeout(function(){var d,g;(d=m.current)===null||d===void 0||d.blur(),(g=m.current)===null||g===void 0||g.focus()})},je=function(){var s=W()(j()().mark(function l(){var d,g,R;return j()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if((d=m.current.editor.editor)!==null&&d!==void 0&&d.firstChild){S.next=2;break}return S.abrupt("return");case 2:return R=(0,r.createElementMap)((g=m.current.editor.editor)===null||g===void 0?void 0:g.firstChild),S.next=5,ce({type:i.MessageType.RICHTEXT,uuid:(0,a.Z)(),sendId:"2",send:"\u674E\u56DB",message:[R],createTime:+new Date,sendType:i.SendType.OUT});case 5:pe(),setTimeout(function(){var H;(H=_.messageRef)===null||H===void 0||H.scrollTo({top:9999999999999,behavior:"smooth"})});case 7:case"end":return S.stop()}},l)}));return function(){return s.apply(this,arguments)}}(),Ce=function(l){var d=x.getCurrentContent(),g=d.createEntity("IMAGE","IMMUTABLE",{src:l}),R=g.getLastCreatedEntityKey(),q=f.EditorState.set(x,{currentContent:g});return f.AtomicBlockUtils.insertAtomicBlock(q,R," ")},xe=function(l){var d=URL.createObjectURL(new Blob(l));T(Ce(d))},Te=function(l){return l==="send-msg"?(je(),"handled"):"not-handled"};return(0,t.jsxs)("div",{className:o.editor,onClick:function(){m.current.focus()},children:[(0,t.jsx)("div",{className:o.emojiBox,children:(0,t.jsx)(te,{})}),(0,t.jsx)(G.ZP,{editorKey:"editor",editorState:x,onChange:ye,plugins:Ee,ref:m,keyBindingFn:ie,handleKeyCommand:Te,handlePastedFiles:xe}),(0,t.jsxs)("span",{className:o.count,children:[(0,t.jsx)(oe,{limit:2e4}),"/20000"]}),(0,t.jsx)(ne,{}),(0,t.jsx)(he,{open:le,onOpenChange:be,suggestions:ve,onSearchChange:Se,onAddMention:function(){},entryComponent:ae,popoverContainer:function(l){var d=l.children;return(0,t.jsx)("div",{style:{minWidth:"100px",position:"absolute"},children:d})}})]})}},52007:function(ee,p,e){e.r(p),e.d(p,{camelToDash:function(){return B},createElement:function(){return O},createElementMap:function(){return V},fileToBlob:function(){return $},fileToBlobUrl:function(){return z},getAllAttributes:function(){return P},getFileName:function(){return G},getSuffix:function(){return f},nodeToString:function(){return X},objToString:function(){return U}});var K=e(25359),j=e.n(K),I=e(49811),W=e.n(I),F=e(37635),b=e.n(F),N=e(93525),M=e.n(N),Z=e(57213),E=e.n(Z),c=e(54306),D=e.n(c),A=e(17607),f=function(n){var r;return((r=/[^.]*$/g.exec(n))===null||r===void 0?void 0:r[0])||""},G=function(n){var r;return((r=/[^/]*$/g.exec(n))===null||r===void 0?void 0:r[0])||""},O=function o(n){if(typeof n=="string")return document.createTextNode(n);var r=document.createElement(n.type),i=(0,A.Z)(n,["type","children"]);if(Object.entries(i).forEach(function(t){var h=D()(t,2),v=h[0],y=h[1];r.setAttribute(v,U(y))}),n.children){var a=n.children.map(function(t){return o(t)});a.forEach(function(t){return r.appendChild(t)})}return r},V=function o(n){if(!(n instanceof HTMLElement))return{type:"span"};var r=n.tagName.toLocaleLowerCase(),i=P(n),a=n.children;return E()(E()({type:r},i),{},{children:a.length?M()(a).map(function(t){return o(t)}):[n.innerText]})},P=function(n){var r=M()(n.attributes).map(function(i){return i.name});return Object.fromEntries(r.map(function(i){return[i,n.getAttribute(i)]}))},U=function(n){return b()(n)!=="object"?n:Object.entries(n).map(function(r){var i=D()(r,2),a=i[0],t=i[1];return"".concat(B(a),":").concat(t,";")}).join("")};function B(o){return o.replace(/[A-Z]/g,function(n){return"-"+n.toLowerCase()})}var X=function(n){if(typeof n=="string")return n;var r=document.createElement("div");return r.appendChild(n),r.innerHTML};function $(o){var n=new FileReader;return new Promise(function(r){n.addEventListener("load",function(i){var a,t,h;if(b()((a=i.target)===null||a===void 0?void 0:a.result)==="object"&&(t=i.target)!==null&&t!==void 0&&t.result){var v;h=new Blob([(v=i.target)===null||v===void 0?void 0:v.result])}else{var y;h=(y=i.target)===null||y===void 0?void 0:y.result}r(h)}),n.readAsArrayBuffer(o)})}function z(o){return L.apply(this,arguments)}function L(){return L=W()(j()().mark(function o(n){var r;return j()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,$(n);case 2:return r=a.sent,a.abrupt("return",URL.createObjectURL(r));case 4:case"end":return a.stop()}},o)})),L.apply(this,arguments)}}}]);
